<div class="datatable">
  <rd-widget>
    <rd-widget-body classes="no-padding">
      <div class="toolBar">
        <div class="toolBarTitle flex">
          <div class="widget-icon space-right">
            <pr-icon icon="'svg-laptopcode'"></pr-icon>
          </div>
          <span class="vertical-center">
            {{ $ctrl.titleText }}
          </span>
        </div>
        <div class="searchBar min-w-[260px]">
          <pr-icon icon="'search'" class="vertical-center" class-name="'searchIcon'"></pr-icon>
          <input
            type="text"
            class="searchInput"
            ng-model="$ctrl.state.textFilter"
            ng-change="$ctrl.onTextFilterChange()"
            placeholder="搜索应用程序..."
            auto-focus
            ng-model-options="{ debounce: 300 }"
          />
        </div>
        <div class="settings vertical-center">
          <span class="setting" ng-class="{ 'setting-active': $ctrl.settings.open }" uib-dropdown dropdown-append-to-body auto-close="disabled" is-open="$ctrl.settings.open">
            <span uib-dropdown-toggle><pr-icon icon="'more-vertical'"></pr-icon></span>
            <div class="dropdown-menu dropdown-menu-right" uib-dropdown-menu>
              <div class="tableMenu">
                <div class="menuHeader"> 表格设置 </div>
                <div class="menuContent">
                    <div>
                        <div class="md-checkbox">
                            <input id="setting_auto_refresh" type="checkbox" ng-model="$ctrl.settings.repeater.autoRefresh" ng-change="$ctrl.onSettingsRepeaterChange()" />
                            <label for="setting_auto_refresh">自动刷新</label>
                        </div>
                        <div ng-if="$ctrl.settings.repeater.autoRefresh">
                            <label for="settings_refresh_rate"> 刷新频率 </label>
                            <select id="settings_refresh_rate" ng-model="$ctrl.settings.repeater.refreshRate" ng-change="$ctrl.onSettingsRepeaterChange()" class="small-select">
                                <option value="10">10秒</option>
                                <option value="30">30秒</option>
                                <option value="60">1分钟</option>
                                <option value="120">2分钟</option>
                                <option value="300">5分钟</option>
                            </select>
                            <span>
                                <pr-icon id="refreshRateChange" style="display: none" icon="'check'" mode="'success'"></pr-icon>
                            </span>
                        </div>
                    </div>
                </div>
                <div>
                  <a type="button" class="btn btn-default btn-sm" ng-click="$ctrl.settings.open = false;">Close</a>
                </div>
              </div>
            </div>
          </span>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table-hover nowrap-cells table">
          <thead>
            <tr>
                <th>
                    <table-column-header
                        col-title="'名称'"
                        can-sort="true"
                        is-sorted="$ctrl.state.orderBy === 'Name'"
                        is-sorted-desc="$ctrl.state.orderBy === 'Name' && $ctrl.state.reverseOrder"
                        ng-click="$ctrl.changeOrderBy('Name')"
                    ></table-column-header>
                </th>
                <th>
                    <table-column-header
                        col-title="'堆栈'"
                        can-sort="true"
                        is-sorted="$ctrl.state.orderBy === 'StackName'"
                        is-sorted-desc="$ctrl.state.orderBy === 'StackName' && $ctrl.state.reverseOrder"
                        ng-click="$ctrl.changeOrderBy('StackName')"
                    ></table-column-header>
                </th>
                <th>
                    <table-column-header
                        col-title="'命名空间'"
                        can-sort="true"
                        is-sorted="$ctrl.state.orderBy === 'Namespace'"
                        is-sorted-desc="$ctrl.state.orderBy === 'Namespace' && $ctrl.state.reverseOrder"
                        ng-click="$ctrl.changeOrderBy('Namespace')"
                    ></table-column-header>
                </th>
                <th>
                    <table-column-header
                        col-title="'镜像'"
                        can-sort="true"
                        is-sorted="$ctrl.state.orderBy === 'Image'"
                        is-sorted-desc="$ctrl.state.orderBy === 'Image' && $ctrl.state.reverseOrder"
                        ng-click="$ctrl.changeOrderBy('Image')"
                    ></table-column-header>
                </th>
                <th>
                    <table-column-header
                        col-title="'CPU 预留'"
                        can-sort="true"
                        is-sorted="$ctrl.state.orderBy === 'CPU'"
                        is-sorted-desc="$ctrl.state.orderBy === 'CPU' && $ctrl.state.reverseOrder"
                        ng-click="$ctrl.changeOrderBy('CPU')"
                    ></table-column-header>
                </th>
                <th>
                    <table-column-header
                        col-title="'内存预留'"
                        can-sort="true"
                        is-sorted="$ctrl.state.orderBy === 'Memory'"
                        is-sorted-desc="$ctrl.state.orderBy === 'Memory' && $ctrl.state.reverseOrder"
                        ng-click="$ctrl.changeOrderBy('Memory')"
                    ></table-column-header>
                </th>
            </tr>
        </thead>
          <tbody>
            <tr
              dir-paginate="item in ($ctrl.state.filteredDataSet = ($ctrl.dataset | filter:$ctrl.state.textFilter | orderBy:$ctrl.state.orderBy:$ctrl.state.reverseOrder | itemsPerPage: $ctrl.state.paginatedItemLimit))"
            >
            <td>
              <a ui-sref="kubernetes.applications.application({ name: item.Name, namespace: item.ResourcePool })">{{ item.Name }}</a>
              <span style="margin-left: 5px" class="label label-info image-tag" ng-if="$ctrl.isSystemNamespace(item)">系统</span>
              <span style="margin-left: 5px" class="label label-primary image-tag" ng-if="!$ctrl.isSystemNamespace(item) && $ctrl.isExternalApplication(item)">外部</span>
          </td>
              <td>{{ item.StackName || '-' }}</td>
              <td>
                <a ui-sref="kubernetes.resourcePools.resourcePool({ id: item.ResourcePool })">{{ item.ResourcePool }}</a>
              </td>
              <td title="{{ item.Image }}"
                >{{ item.Image | truncate : 64 }} <span ng-if="item.Containers.length > 1">+ {{ item.Containers.length - 1 }}</span></td
              >
              <td>{{ item.CPU | kubernetesApplicationCPUValue }}</td>
              <td>{{ item.Memory | humansize }}</td>
            </tr>
            <tr ng-if="!$ctrl.dataset">
              <td colspan="6" class="text-muted text-center">加载中...</td>
            </tr>
            <tr ng-if="$ctrl.state.filteredDataSet.length === 0">
              <td colspan="6" class="text-muted text-center">无可用堆栈。</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="footer" ng-if="$ctrl.dataset">
        <div class="infoBar" ng-if="$ctrl.state.selectedItemCount !== 0"> {{ $ctrl.state.selectedItemCount }} 项已选择 </div>
        <div class="paginationControls">
          <form class="form-inline vertical-center">
            <span class="limitSelector">
              <span style="margin-right: 5px"> 每页项目 </span>
              <select class="form-control" ng-model="$ctrl.state.paginatedItemLimit" ng-change="$ctrl.changePaginationLimit()" data-cy="component-paginationSelect">
                <option value="0">全部</option>
                <option value="10">10</option>
                <option value="25">25</option>
                <option value="50">50</option>
                <option value="100">100</option>
              </select>
            </span>
            <dir-pagination-controls max-size="5"></dir-pagination-controls>
          </form>
        </div>
      </div>
    </rd-widget-body>
  </rd-widget>
</div>
